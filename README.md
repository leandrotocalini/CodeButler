# CodeButler

**Your code's personal butler** - Claude Code execution via WhatsApp

Built with Go â€¢ Powered by Claude Code SDK â€¢ Bidirectional Communication

---

## What is CodeButler?

CodeButler is a **bidirectional WhatsApp interface** for Claude Code. It runs as a background agent that:

1. **Receives** WhatsApp messages and executes them as Claude Code prompts
2. **Sends** Claude's questions back to WhatsApp (1/2/3 options)
3. **Receives** your numeric responses and passes them to Claude
4. **Delivers** final results back via WhatsApp

**Code from anywhere. Claude asks, you answer via WhatsApp. Simple.**

### Key Features

- ğŸ¤– **WhatsApp Integration** - Control Claude Code from your phone
- ğŸ“ **Multi-Repository** - Work across multiple repositories
- ğŸ™ï¸ **Voice Messages** - Optional transcription with Whisper API
- ğŸ”’ **Secure by Design** - Single authorized group access
- âš¡ **Background Execution** - Long-running tasks don't block
- ğŸ¯ **Claude Code SDK** - Execute real Claude Code commands

### Core Concept

```
WhatsApp Group â†â†’ CodeButler (Go) â†â†’ Claude Code CLI (per-repo)
                        â†“
                 Sources/ directory
                 â”œâ”€â”€ project-a/ (with CLAUDE.md)
                 â”œâ”€â”€ project-b/ (with CLAUDE.md)
                 â””â”€â”€ project-c/ (with CLAUDE.md)
```

## Quick Start

### First Time Setup

```bash
# 1. Clone this repo
git clone https://github.com/yourusername/CodeButler.git
cd CodeButler

# 2. Open in Claude Code
claude

# Claude will automatically offer to set up CodeButler!
# Just say "yes" and follow the wizard.
```

**Or manually:**

```bash
# Install dependencies
go mod download

# Build and run setup wizard
go build -o codebutler cmd/codebutler/main.go
./codebutler
```

The wizard asks:
- **Voice transcription?** (OpenAI API key for Whisper)
- **Group name?** (default: "CodeButler Developer")
- **Bot prefix?** (default: "[BOT]")
- **Code directory?** (default: "./Sources")

Then scan the QR code with WhatsApp.

### Start the Agent

After setup, start the WhatsApp agent:

```bash
# Easy way
./start-agent.sh

# Or manually
go build -o codebutler-agent cmd/agent/main.go
./codebutler-agent
```

**When using Claude Code**, I'll offer to start it automatically in background.

### Using It

Send messages to your **CodeButler Developer** WhatsApp group:

```
You: "add tests to the authentication module"
Bot: Mensaje recibido! Procesando...

[Claude Code processes the request]

Bot: âœ… Added 12 unit tests covering login, logout, password reset...
```

Commands:
- `repos` - List repositories
- `use <name>` - Select repository
- `status` - Show active repository
- `run <prompt>` - Execute task
- `clear` - Clear selection
- `help` - Show help

### Remote Updates via WhatsApp

You can update CodeButler remotely via WhatsApp! If you push changes to GitHub:

```
You (via WhatsApp): "reinstall code butler"

Bot: ğŸ”„ Pulling latest changes...
     ğŸ”¨ Rebuilding agent...
     ğŸš€ Restarting...
     âœ… CodeButler updated to latest version!
```

This uses the `/reinstall-code-butler` skill that:
- Pulls latest changes from `main`
- Rebuilds the Go agent
- Restarts the agent automatically

Perfect for updating CodeButler on remote machines!

## Documentation

- [Product Specification](PRODUCT.md) - What CodeButler does and why
- [Technical Documentation](CLAUDE.md) - Architecture and implementation details
- [Implementation Status](PHASE_7_COMPLETE.md) - Current phase completion

## Project Structure

```
CodeButler/
â”œâ”€â”€ README.md                    # You are here
â”œâ”€â”€ CLAUDE.md                    # Instructions for Claude Code
â”œâ”€â”€ LICENSE
â”œâ”€â”€ .gitignore
â”‚
â”œâ”€â”€ config.json                  # Generated by setup (gitignored)
â”œâ”€â”€ whatsapp-session/            # WhatsApp data (gitignored)
â”œâ”€â”€ Sources/                     # Your repos (gitignored)
â”‚
â”œâ”€â”€ ButlerAgent/                 # Go agent code
â”‚   â”œâ”€â”€ cmd/
â”‚   â”‚   â”œâ”€â”€ codebutler/          # Setup wizard
â”‚   â”‚   â””â”€â”€ agent/               # WhatsApp agent
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ whatsapp/            # WhatsApp client
â”‚   â”‚   â”œâ”€â”€ config/              # Config management
â”‚   â”‚   â”œâ”€â”€ access/              # Access control
â”‚   â”‚   â”œâ”€â”€ audio/               # Voice transcription
â”‚   â”‚   â”œâ”€â”€ bot/                 # Bot logic
â”‚   â”‚   â”œâ”€â”€ commands/            # Command parsing
â”‚   â”‚   â””â”€â”€ repo/                # Repository management
â”‚   â”œâ”€â”€ go.mod
â”‚   â””â”€â”€ go.sum
â”‚
â”œâ”€â”€ docs/                        # Documentation
â”‚   â”œâ”€â”€ ARCHITECTURE.md
â”‚   â”œâ”€â”€ BIDIRECTIONAL_AGENT.md
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ start-agent.sh               # Start the agent
â”œâ”€â”€ send-response.sh             # Send response to WhatsApp
â””â”€â”€ ask-question.sh              # Ask question via WhatsApp
```

## Configuration

Generated automatically by wizard (`config.json`):

```json
{
  "whatsapp": {
    "sessionPath": "./whatsapp-session",
    "personalNumber": "5491134567890@s.whatsapp.net",
    "groupJID": "120363123456789012@g.us",
    "groupName": "CodeButler Developer"
  },
  "openai": {
    "apiKey": ""
  },
  "claudeCode": {
    "oauthToken": ""
  },
  "sources": {
    "rootPath": "./Sources"
  }
}
```

## Why CodeButler?

### The Problem

Using Claude Code typically requires:
- Being at your computer
- Switching between projects manually
- Waiting for commands to complete
- Managing multiple terminal windows

### The Solution

CodeButler lets you:
- Execute Claude Code from anywhere via WhatsApp
- Switch repositories with simple commands
- Get results automatically when tasks complete
- Use voice messages while away from computer
- Work on multiple projects from one chat

### Why Go?

- **Single binary** - Deploy one file, no dependencies
- **Fast startup** - ~10ms vs Node.js ~200ms
- **Low memory** - ~20MB idle vs Node.js ~50MB
- **Great concurrency** - Background task execution
- **Cross-platform** - Easy to build for macOS, Linux, Windows

### Why Claude Code?

- Uses your Claude Pro/Max subscription
- Full understanding of code structure
- File operations, bash, web access
- Better than API for development tasks

## Commands

All commands use `@codebutler` prefix:

```bash
@codebutler help              # Show help
@codebutler repos             # List repositories
@codebutler use <repo>        # Select repository
@codebutler status            # Show active repo
@codebutler run <prompt>      # Execute Claude Code
@codebutler clear             # Clear session
```

**Aliases:**
- `repos` = `list` = `ls`
- `use` = `select` = `cd`
- `status` = `current` = `pwd`
- `run` = `exec` = `do`
- `clear` = `reset`

## Development

### Building

```bash
# Development build
go build -o codebutler ./cmd/codebutler/

# Test integration
go build -o test-integration ./cmd/test-integration/

# Production build (optimized)
go build -ldflags="-s -w" -o codebutler ./cmd/codebutler/
```

### Testing

```bash
# Run unit tests
go test ./internal/commands/... -v
go test ./internal/repo/... -v
go test ./internal/config/... -v
go test ./internal/access/... -v

# Run integration test
./test-integration
```

## Security

- **Access Control** - Only authorized WhatsApp group
- **Config Protection** - `config.json` has 0600 permissions
- **WhatsApp Encryption** - End-to-end encrypted
- **OAuth Token** - Use environment variable (recommended)
- **No Shell Injection** - Uses exec.Command directly

## Implementation Status

- [x] **Phase 1**: WhatsApp Integration âœ…
- [x] **Phase 2**: Configuration System âœ…
- [x] **Phase 3**: Access Control âœ…
- [x] **Phase 4**: Audio Transcription âœ…
- [x] **Phase 5**: Repository Management âœ…
- [x] **Phase 6**: Claude Code Executor âœ…
- [x] **Phase 7**: First-time Setup âœ…
- [ ] **Phase 8**: Advanced Features
- [ ] **Phase 9**: Testing & Polish
- [ ] **Phase 10**: Documentation
- [ ] **Phase 11**: Build & Deploy

**Current Status**: Phases 1-7 COMPLETE and PRODUCTION-READY

See phase completion docs:
- [PHASE_6_COMPLETE.md](PHASE_6_COMPLETE.md)
- [PHASE_7_COMPLETE.md](PHASE_7_COMPLETE.md)

## FAQ

### Does this work with Claude API?

CodeButler is designed for Claude Code CLI, which requires Claude Pro/Max subscription. It doesn't use the Claude API.

### How much does it cost?

- CodeButler itself: Free (open source)
- Claude Pro/Max: $20/month (includes Claude Code)
- OpenAI Whisper API: ~$0.006/minute (optional, for voice)
- WhatsApp: Free

### Can multiple people use it?

Yes, but all users in the group have the same access to your repositories. Use with trusted team members only.

### What's CLAUDE.md?

A file in each repository that tells Claude Code how to work with that project. Required for CodeButler to use a repository.

### Does it violate WhatsApp ToS?

CodeButler uses WhatsApp Web protocol. Personal use is typically safe, but commercial use may violate ToS. Use at your own risk.

## License

MIT License - See [LICENSE](LICENSE) file

---

**Built with â¤ï¸ for developers who want remote Claude Code execution**
